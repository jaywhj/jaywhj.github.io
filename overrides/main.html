<!-- overrides/main.html -->
{% extends "base.html" %}

{% block content %}
  {{ super() }}
  <!-- 自动插入评论容器（支持隐藏） -->
  {% if not page.meta.hide_comment %}
    <div id="twikoo-comments" style="margin: 2rem 0;">
      <p style="text-align: center; color: #666; font-size: 0.9em;">
        加载评论中...
      </p>
    </div>
  {% endif %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!-- 延迟加载 Twikoo -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 检查是否存在评论容器
      const el = document.getElementById('twikoo-comments');
      if (!el) return;

      // 延迟加载 Twikoo
      setTimeout(() => {
        const script = document.createElement('script');
        // https://registry.npmmirror.com/twikoo/1.6.41/files/dist/twikoo.min.js
        // https://cdn.jsdelivr.net/npm/twikoo@1.6.41/dist/twikoo.min.js
        script.src = 'https://s4.zstatic.net/ajax/libs/twikoo/1.6.41/twikoo.min.js';
        script.onload = () => {
          // 清除加载提示
          el.innerHTML = '';
          // 初始化 Twikoo
          twikoo.init({
            envId: 'https://twikoo-jaywhj.netlify.app/.netlify/functions/twikoo',
            el: '#twikoo-comments',
            path: location.pathname,
          });
        };
        document.head.appendChild(script);
      }, 2000); // 延迟 2 秒加载
    });
  </script>
{% endblock %}
